{"version":3,"sources":["../../node_modules/lodash.debounce/index.js","utils/is-mobile.js","../../node_modules/scrollama/build/scrollama.js","../../node_modules/stickyfilljs/dist/stickyfill.js","chapter.js","geoData.js","getSize.js","utils/slugify.js","simpleMap.js","scatterplot.js","lazyLoadVideo.js","lazyLoadImg.js","graphic.js","footer.js","main.js"],"names":["isMobile","android","navigator","userAgent","match","blackberry","ios","opera","windows","any","getChapter","is_mobile","zoomOffset","chapter","center","zoom","getCottingham","cottingham","cData","map","d","parseGeoData","arr","getSize","id","width","document","querySelector","clientWidth","height","clientHeight","slugify","string","a","b","p","RegExp","split","join","toString","toLowerCase","replace","c","charAt","indexOf","Map","data","W","H","$svg","d3","select","routeData","townData","townInfo","markerData","_red","_purple","_blue","_green","_green2","_transition","init","attr","$plotG","selectAll","$countyG","$routeG","$noteG","classed","projection","geoTransverseMercator","rotate","fitExtent","Math","min","path","geoPath","startPoint","features","properties","fillFunc","text","circleLoop","_loop","transition","duration","delay","highlightTown","length","forEach","i","raise","transitMap","style","fillColor","scaleLinear","domain","range","parseChapterData","push","pos","ScatterPlot","_yellow","_gray","rangeW","$scatterG","$popG","popScale","createScale","$incomeG","incomeScale","$ownerG","ownerScale","$bachelorG","bachelorScale","$headlineG","$legendG","$g","scale","title","yAxis","axisBottom","ticks","tickSize","tickFormat","axis","call","circle","town","on","console","log","_id","posX","posY","append","remove","active","isActive","shift","hed_1","lazyLoadVideo","allVideoElem","videoEl","$video","dataSrc","getElementById","load","lazyLoadImg","allElem","allNodes","nodes","node","pic","resize","Stickyfill","add","maxMobileSize","scatterplot","scroller","setup","step","offset","onStepEnter","response","element","index","direction","updateGraphic","onStepExit","newIdx","max","dataIdx","thisChapter","fallbackData","image","url","hed","storyData","loadJS","src","cb","ref","getElementsByTagName","script","createElement","async","parentNode","insertBefore","onload","loadStories","request","XMLHttpRequest","v","Date","now","open","status","JSON","parse","responseText","onerror","send","createLink","recircHTML","window","location","href","html","filter","includes","slice","setupSocialJS","s","js","fjs","$body","previousWidth","setupStickyHeader","$header","$menu","$toggle","visible","Promise","all","json","csv","then","files","graphic","addEventListener","offsetWidth","footer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACzXA;AAEA,IAAMA,QAAQ,GAAG;AAChBC,EAAAA,OAAO,EAAE;AAAA,WAAMC,SAAS,CAACC,SAAV,CAAoBC,KAApB,CAA0B,UAA1B,CAAN;AAAA,GADO;AAGhBC,EAAAA,UAAU,EAAE;AAAA,WAAMH,SAAS,CAACC,SAAV,CAAoBC,KAApB,CAA0B,aAA1B,CAAN;AAAA,GAHI;AAKhBE,EAAAA,GAAG,EAAE;AAAA,WAAMJ,SAAS,CAACC,SAAV,CAAoBC,KAApB,CAA0B,mBAA1B,CAAN;AAAA,GALW;AAOhBG,EAAAA,KAAK,EAAE;AAAA,WAAML,SAAS,CAACC,SAAV,CAAoBC,KAApB,CAA0B,aAA1B,CAAN;AAAA,GAPS;AAShBI,EAAAA,OAAO,EAAE;AAAA,WAAMN,SAAS,CAACC,SAAV,CAAoBC,KAApB,CAA0B,WAA1B,CAAN;AAAA,GATO;AAWhBK,EAAAA,GAAG,EAAE;AAAA,WACJT,QAAQ,CAACC,OAAT,MACAD,QAAQ,CAACK,UAAT,EADA,IAEAL,QAAQ,CAACM,GAAT,EAFA,IAGAN,QAAQ,CAACO,KAAT,EAHA,IAIAP,QAAQ,CAACQ,OAAT,EALI;AAAA;AAXW,CAAjB;eAoBeR;;;;;ACtBf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACjiBA;;;;AAEe,SAASU,UAAT,GAAqB;AAChC,MAAMC,SAAS,GAAGX,kBAASS,GAAT,EAAlB;;AACA,MAAMG,UAAU,GAAGD,SAAS,GAAE,CAAC,CAAH,GAAM,CAAlC;AACA,MAAME,OAAO,GAAG;AACZ,gBAAY;AACR,aAAO;AACHC,QAAAA,MAAM,EAAE,CAAC,CAAC,UAAF,EAAc,SAAd,CADL;AAEHC,QAAAA,IAAI,EAAE,IAAEH;AAFL;AADC,KADA;AAOZ,gBAAY;AACR,aAAO;AACHE,QAAAA,MAAM,EAAE,CAAC,CAAC,SAAF,EAAa,SAAb,CADL;AAEHC,QAAAA,IAAI,EAAE,KAAGH;AAFN;AADC,KAPA;AAaZ,gBAAY;AACR,aAAO;AACHE,QAAAA,MAAM,EAAE,CAAC,CAAC,SAAF,EAAa,SAAb,CADL;AAEHC,QAAAA,IAAI,EAAE,OAAKH;AAFR;AADC,KAbA;AAmBZ,cAAU;AACN,aAAO;AACHE,QAAAA,MAAM,EAAE,CAAC,CAAC,UAAF,EAAc,UAAd,CADL;AAEHC,QAAAA,IAAI,EAAE,KAAGH;AAFN;AADD,KAnBE;AAyBZ,cAAU;AACN,aAAO;AACHE,QAAAA,MAAM,EAAE,CAAC,CAAC,UAAF,EAAc,UAAd,CADL;AAEHC,QAAAA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","file":"main.js","sourceRoot":"../src/js","sourcesContent":["/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = debounce;\n","// device sniffing for mobile\n\nconst isMobile = {\n\tandroid: () => navigator.userAgent.match(/Android/i),\n\n\tblackberry: () => navigator.userAgent.match(/BlackBerry/i),\n\n\tios: () => navigator.userAgent.match(/iPhone|iPad|iPod/i),\n\n\topera: () => navigator.userAgent.match(/Opera Mini/i),\n\n\twindows: () => navigator.userAgent.match(/IEMobile/i),\n\n\tany: () => (\n\t\tisMobile.android() ||\n\t\tisMobile.blackberry() ||\n\t\tisMobile.ios() ||\n\t\tisMobile.opera() ||\n\t\tisMobile.windows()\n\t),\n}\n\nexport default isMobile\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.scrollama = factory());\n}(this, (function () { 'use strict';\n\n// DOM helper functions\n\n// public\nfunction selectAll(selector, parent) {\n  if ( parent === void 0 ) parent = document;\n\n  if (typeof selector === 'string') {\n    return Array.from(parent.querySelectorAll(selector));\n  } else if (selector instanceof Element) {\n    return [selector];\n  } else if (selector instanceof NodeList) {\n    return Array.from(selector);\n  } else if (selector instanceof Array) {\n    return selector;\n  }\n  return [];\n}\n\nfunction getOffsetId(id) {\n  return (\"scrollama__debug-offset--\" + id);\n}\n\n// SETUP\nfunction setupOffset(ref) {\n  var id = ref.id;\n  var offsetVal = ref.offsetVal;\n  var stepClass = ref.stepClass;\n\n  var el = document.createElement(\"div\");\n  el.id = getOffsetId(id);\n  el.className = \"scrollama__debug-offset\";\n  el.style.position = \"fixed\";\n  el.style.left = \"0\";\n  el.style.width = \"100%\";\n  el.style.height = \"0\";\n  el.style.borderTop = \"2px dashed black\";\n  el.style.zIndex = \"9999\";\n\n  var p = document.createElement(\"p\");\n  p.innerHTML = \"\\\".\" + stepClass + \"\\\" trigger: <span>\" + offsetVal + \"</span>\";\n  p.style.fontSize = \"12px\";\n  p.style.fontFamily = \"monospace\";\n  p.style.color = \"black\";\n  p.style.margin = \"0\";\n  p.style.padding = \"6px\";\n  el.appendChild(p);\n  document.body.appendChild(el);\n}\n\nfunction setup(ref) {\n  var id = ref.id;\n  var offsetVal = ref.offsetVal;\n  var stepEl = ref.stepEl;\n\n  var stepClass = stepEl[0].className;\n  setupOffset({ id: id, offsetVal: offsetVal, stepClass: stepClass });\n}\n\n// UPDATE\nfunction update(ref) {\n  var id = ref.id;\n  var offsetMargin = ref.offsetMargin;\n  var offsetVal = ref.offsetVal;\n  var format = ref.format;\n\n  var post = format === \"pixels\" ? \"px\" : \"\";\n  var idVal = getOffsetId(id);\n  var el = document.getElementById(idVal);\n  el.style.top = offsetMargin + \"px\";\n  el.querySelector(\"span\").innerText = \"\" + offsetVal + post;\n}\n\nfunction notifyStep(ref) {\n  var id = ref.id;\n  var index = ref.index;\n  var state = ref.state;\n\n  var prefix = \"scrollama__debug-step--\" + id + \"-\" + index;\n  var elA = document.getElementById((prefix + \"_above\"));\n  var elB = document.getElementById((prefix + \"_below\"));\n  var display = state === \"enter\" ? \"block\" : \"none\";\n\n  if (elA) { elA.style.display = display; }\n  if (elB) { elB.style.display = display; }\n}\n\nfunction scrollama() {\n  var OBSERVER_NAMES = [\n    \"stepAbove\",\n    \"stepBelow\",\n    \"stepProgress\",\n    \"viewportAbove\",\n    \"viewportBelow\"\n  ];\n\n  var cb = {};\n  var io = {};\n\n  var id = null;\n  var stepEl = [];\n  var stepOffsetHeight = [];\n  var stepOffsetTop = [];\n  var stepStates = [];\n\n  var offsetVal = 0;\n  var offsetMargin = 0;\n  var viewH = 0;\n  var pageH = 0;\n  var previousYOffset = 0;\n  var progressThreshold = 0;\n\n  var isReady = false;\n  var isEnabled = false;\n  var isDebug = false;\n\n  var progressMode = false;\n  var preserveOrder = false;\n  var triggerOnce = false;\n\n  var direction = \"down\";\n  var format = \"percent\";\n\n  var exclude = [];\n\n  /* HELPERS */\n  function err(msg) {\n    console.error((\"scrollama error: \" + msg));\n  }\n\n  function reset() {\n    cb = {\n      stepEnter: function () {},\n      stepExit: function () {},\n      stepProgress: function () {}\n    };\n    io = {};\n  }\n\n  function generateInstanceID() {\n    var a = \"abcdefghijklmnopqrstuv\";\n    var l = a.length;\n    var t = Date.now();\n    var r = [0, 0, 0].map(function (d) { return a[Math.floor(Math.random() * l)]; }).join(\"\");\n    return (\"\" + r + t);\n  }\n\n  function getOffsetTop(el) {\n    var ref = el.getBoundingClientRect();\n    var top = ref.top;\n    var scrollTop = window.pageYOffset;\n    var clientTop = document.body.clientTop || 0;\n    return top + scrollTop - clientTop;\n  }\n\n  function getPageHeight() {\n    var body = document.body;\n    var html = document.documentElement;\n\n    return Math.max(\n      body.scrollHeight,\n      body.offsetHeight,\n      html.clientHeight,\n      html.scrollHeight,\n      html.offsetHeight\n    );\n  }\n\n  function getIndex(element) {\n    return +element.getAttribute(\"data-scrollama-index\");\n  }\n\n  function updateDirection() {\n    if (window.pageYOffset > previousYOffset) { direction = \"down\"; }\n    else if (window.pageYOffset < previousYOffset) { direction = \"up\"; }\n    previousYOffset = window.pageYOffset;\n  }\n\n  function disconnectObserver(name) {\n    if (io[name]) { io[name].forEach(function (d) { return d.disconnect(); }); }\n  }\n\n  function handleResize() {\n    viewH = window.innerHeight;\n    pageH = getPageHeight();\n\n    var mult = format === \"pixels\" ? 1 : viewH;\n    offsetMargin = offsetVal * mult;\n\n    if (isReady) {\n      stepOffsetHeight = stepEl.map(function (el) { return el.getBoundingClientRect().height; });\n      stepOffsetTop = stepEl.map(getOffsetTop);\n      if (isEnabled) { updateIO(); }\n    }\n\n    if (isDebug) { update({ id: id, offsetMargin: offsetMargin, offsetVal: offsetVal, format: format }); }\n  }\n\n  function handleEnable(enable) {\n    if (enable && !isEnabled) {\n      // enable a disabled scroller\n      if (isReady) {\n        // enable a ready scroller\n        updateIO();\n      } else {\n        // can't enable an unready scroller\n        err(\"scrollama error: enable() called before scroller was ready\");\n        isEnabled = false;\n        return; // all is not well, don't set the requested state\n      }\n    }\n    if (!enable && isEnabled) {\n      // disable an enabled scroller\n      OBSERVER_NAMES.forEach(disconnectObserver);\n    }\n    isEnabled = enable; // all is well, set requested state\n  }\n\n  function createThreshold(height) {\n    var count = Math.ceil(height / progressThreshold);\n    var t = [];\n    var ratio = 1 / count;\n    for (var i = 0; i < count; i += 1) {\n      t.push(i * ratio);\n    }\n    return t;\n  }\n\n  /* NOTIFY CALLBACKS */\n  function notifyStepProgress(element, progress) {\n    var index = getIndex(element);\n    if (progress !== undefined) { stepStates[index].progress = progress; }\n    var resp = { element: element, index: index, progress: stepStates[index].progress };\n\n    if (stepStates[index].state === \"enter\") { cb.stepProgress(resp); }\n  }\n\n  function notifyOthers(index, location) {\n    if (location === \"above\") {\n      // check if steps above/below were skipped and should be notified first\n      for (var i = 0; i < index; i += 1) {\n        var ss = stepStates[i];\n        if (ss.state !== \"enter\" && ss.direction !== \"down\") {\n          notifyStepEnter(stepEl[i], \"down\", false);\n          notifyStepExit(stepEl[i], \"down\");\n        } else if (ss.state === \"enter\") { notifyStepExit(stepEl[i], \"down\"); }\n        // else if (ss.direction === 'up') {\n        //   notifyStepEnter(stepEl[i], 'down', false);\n        //   notifyStepExit(stepEl[i], 'down');\n        // }\n      }\n    } else if (location === \"below\") {\n      for (var i$1 = stepStates.length - 1; i$1 > index; i$1 -= 1) {\n        var ss$1 = stepStates[i$1];\n        if (ss$1.state === \"enter\") {\n          notifyStepExit(stepEl[i$1], \"up\");\n        }\n        if (ss$1.direction === \"down\") {\n          notifyStepEnter(stepEl[i$1], \"up\", false);\n          notifyStepExit(stepEl[i$1], \"up\");\n        }\n      }\n    }\n  }\n\n  function notifyStepEnter(element, dir, check) {\n    if ( check === void 0 ) check = true;\n\n    var index = getIndex(element);\n    var resp = { element: element, index: index, direction: dir };\n\n    // store most recent trigger\n    stepStates[index].direction = dir;\n    stepStates[index].state = \"enter\";\n    if (preserveOrder && check && dir === \"down\") { notifyOthers(index, \"above\"); }\n\n    if (preserveOrder && check && dir === \"up\") { notifyOthers(index, \"below\"); }\n\n    if (cb.stepEnter && !exclude[index]) {\n      cb.stepEnter(resp, stepStates);\n      if (isDebug) { notifyStep({ id: id, index: index, state: \"enter\" }); }\n      if (triggerOnce) { exclude[index] = true; }\n    }\n\n    if (progressMode) { notifyStepProgress(element); }\n  }\n\n  function notifyStepExit(element, dir) {\n    var index = getIndex(element);\n    var resp = { element: element, index: index, direction: dir };\n\n    if (progressMode) {\n      if (dir === \"down\" && stepStates[index].progress < 1)\n        { notifyStepProgress(element, 1); }\n      else if (dir === \"up\" && stepStates[index].progress > 0)\n        { notifyStepProgress(element, 0); }\n    }\n\n    // store most recent trigger\n    stepStates[index].direction = dir;\n    stepStates[index].state = \"exit\";\n\n    cb.stepExit(resp, stepStates);\n    if (isDebug) { notifyStep({ id: id, index: index, state: \"exit\" }); }\n  }\n\n  /* OBSERVER - INTERSECT HANDLING */\n  // this is good for entering while scrolling down + leaving while scrolling up\n  function intersectStepAbove(ref) {\n    var entry = ref[0];\n\n    updateDirection();\n    var isIntersecting = entry.isIntersecting;\n    var boundingClientRect = entry.boundingClientRect;\n    var target = entry.target;\n\n    // bottom = bottom edge of element from top of viewport\n    // bottomAdjusted = bottom edge of element from trigger\n    var top = boundingClientRect.top;\n    var bottom = boundingClientRect.bottom;\n    var topAdjusted = top - offsetMargin;\n    var bottomAdjusted = bottom - offsetMargin;\n    var index = getIndex(target);\n    var ss = stepStates[index];\n\n    // entering above is only when topAdjusted is negative\n    // and bottomAdjusted is positive\n    if (\n      isIntersecting &&\n      topAdjusted <= 0 &&\n      bottomAdjusted >= 0 &&\n      direction === \"down\" &&\n      ss.state !== \"enter\"\n    )\n      { notifyStepEnter(target, direction); }\n\n    // exiting from above is when topAdjusted is positive and not intersecting\n    if (\n      !isIntersecting &&\n      topAdjusted > 0 &&\n      direction === \"up\" &&\n      ss.state === \"enter\"\n    )\n      { notifyStepExit(target, direction); }\n  }\n\n  // this is good for entering while scrolling up + leaving while scrolling down\n  function intersectStepBelow(ref) {\n    var entry = ref[0];\n\n    updateDirection();\n    var isIntersecting = entry.isIntersecting;\n    var boundingClientRect = entry.boundingClientRect;\n    var target = entry.target;\n\n    // bottom = bottom edge of element from top of viewport\n    // bottomAdjusted = bottom edge of element from trigger\n    var top = boundingClientRect.top;\n    var bottom = boundingClientRect.bottom;\n    var topAdjusted = top - offsetMargin;\n    var bottomAdjusted = bottom - offsetMargin;\n    var index = getIndex(target);\n    var ss = stepStates[index];\n\n    // entering below is only when bottomAdjusted is positive\n    // and topAdjusted is negative\n    if (\n      isIntersecting &&\n      topAdjusted <= 0 &&\n      bottomAdjusted >= 0 &&\n      direction === \"up\" &&\n      ss.state !== \"enter\"\n    )\n      { notifyStepEnter(target, direction); }\n\n    // exiting from above is when bottomAdjusted is negative and not intersecting\n    if (\n      !isIntersecting &&\n      bottomAdjusted < 0 &&\n      direction === \"down\" &&\n      ss.state === \"enter\"\n    )\n      { notifyStepExit(target, direction); }\n  }\n\n  /*\n\tif there is a scroll event where a step never intersects (therefore\n\tskipping an enter/exit trigger), use this fallback to detect if it is\n\tin view\n\t*/\n  function intersectViewportAbove(ref) {\n    var entry = ref[0];\n\n    updateDirection();\n    var isIntersecting = entry.isIntersecting;\n    var target = entry.target;\n    var index = getIndex(target);\n    var ss = stepStates[index];\n\n    if (\n      isIntersecting &&\n      direction === \"down\" &&\n      ss.direction !== \"down\" &&\n      ss.state !== \"enter\"\n    ) {\n      notifyStepEnter(target, \"down\");\n      notifyStepExit(target, \"down\");\n    }\n  }\n\n  function intersectViewportBelow(ref) {\n    var entry = ref[0];\n\n    updateDirection();\n    var isIntersecting = entry.isIntersecting;\n    var target = entry.target;\n    var index = getIndex(target);\n    var ss = stepStates[index];\n    if (\n      isIntersecting &&\n      direction === \"up\" &&\n      ss.direction === \"down\" &&\n      ss.state !== \"enter\"\n    ) {\n      notifyStepEnter(target, \"up\");\n      notifyStepExit(target, \"up\");\n    }\n  }\n\n  function intersectStepProgress(ref) {\n    var entry = ref[0];\n\n    updateDirection();\n    var isIntersecting = entry.isIntersecting;\n    var intersectionRatio = entry.intersectionRatio;\n    var boundingClientRect = entry.boundingClientRect;\n    var target = entry.target;\n    var bottom = boundingClientRect.bottom;\n    var bottomAdjusted = bottom - offsetMargin;\n    if (isIntersecting && bottomAdjusted >= 0) {\n      notifyStepProgress(target, +intersectionRatio);\n    }\n  }\n\n  /*  OBSERVER - CREATION */\n  // jump into viewport\n  function updateViewportAboveIO() {\n    io.viewportAbove = stepEl.map(function (el, i) {\n      var marginTop = pageH - stepOffsetTop[i];\n      var marginBottom = offsetMargin - viewH - stepOffsetHeight[i];\n      var rootMargin = marginTop + \"px 0px \" + marginBottom + \"px 0px\";\n      var options = { rootMargin: rootMargin };\n      // console.log(options);\n      var obs = new IntersectionObserver(intersectViewportAbove, options);\n      obs.observe(el);\n      return obs;\n    });\n  }\n\n  function updateViewportBelowIO() {\n    io.viewportBelow = stepEl.map(function (el, i) {\n      var marginTop = -offsetMargin - stepOffsetHeight[i];\n      var marginBottom = offsetMargin - viewH + stepOffsetHeight[i] + pageH;\n      var rootMargin = marginTop + \"px 0px \" + marginBottom + \"px 0px\";\n      var options = { rootMargin: rootMargin };\n      // console.log(options);\n      var obs = new IntersectionObserver(intersectViewportBelow, options);\n      obs.observe(el);\n      return obs;\n    });\n  }\n\n  // look above for intersection\n  function updateStepAboveIO() {\n    io.stepAbove = stepEl.map(function (el, i) {\n      var marginTop = -offsetMargin + stepOffsetHeight[i];\n      var marginBottom = offsetMargin - viewH;\n      var rootMargin = marginTop + \"px 0px \" + marginBottom + \"px 0px\";\n      var options = { rootMargin: rootMargin };\n      // console.log(options);\n      var obs = new IntersectionObserver(intersectStepAbove, options);\n      obs.observe(el);\n      return obs;\n    });\n  }\n\n  // look below for intersection\n  function updateStepBelowIO() {\n    io.stepBelow = stepEl.map(function (el, i) {\n      var marginTop = -offsetMargin;\n      var marginBottom = offsetMargin - viewH + stepOffsetHeight[i];\n      var rootMargin = marginTop + \"px 0px \" + marginBottom + \"px 0px\";\n      var options = { rootMargin: rootMargin };\n      // console.log(options);\n      var obs = new IntersectionObserver(intersectStepBelow, options);\n      obs.observe(el);\n      return obs;\n    });\n  }\n\n  // progress progress tracker\n  function updateStepProgressIO() {\n    io.stepProgress = stepEl.map(function (el, i) {\n      var marginTop = stepOffsetHeight[i] - offsetMargin;\n      var marginBottom = -viewH + offsetMargin;\n      var rootMargin = marginTop + \"px 0px \" + marginBottom + \"px 0px\";\n      var threshold = createThreshold(stepOffsetHeight[i]);\n      var options = { rootMargin: rootMargin, threshold: threshold };\n      // console.log(options);\n      var obs = new IntersectionObserver(intersectStepProgress, options);\n      obs.observe(el);\n      return obs;\n    });\n  }\n\n  function updateIO() {\n    OBSERVER_NAMES.forEach(disconnectObserver);\n\n    updateViewportAboveIO();\n    updateViewportBelowIO();\n    updateStepAboveIO();\n    updateStepBelowIO();\n\n    if (progressMode) { updateStepProgressIO(); }\n  }\n\n  /* SETUP FUNCTIONS */\n\n  function indexSteps() {\n    stepEl.forEach(function (el, i) { return el.setAttribute(\"data-scrollama-index\", i); });\n  }\n\n  function setupStates() {\n    stepStates = stepEl.map(function () { return ({\n      direction: null,\n      state: null,\n      progress: 0\n    }); });\n  }\n\n  function addDebug() {\n    if (isDebug) { setup({ id: id, stepEl: stepEl, offsetVal: offsetVal }); }\n  }\n\n  function isYScrollable(element) {\n    var style = window.getComputedStyle(element);\n    return (\n      (style.overflowY === \"scroll\" || style.overflowY === \"auto\") &&\n      element.scrollHeight > element.clientHeight\n    );\n  }\n\n  // recursively search the DOM for a parent container with overflowY: scroll and fixed height\n  // ends at document\n  function anyScrollableParent(element) {\n    if (element && element.nodeType === 1) {\n      // check dom elements only, stop at document\n      // if a scrollable element is found return the element\n      // if not continue to next parent\n      return isYScrollable(element)\n        ? element\n        : anyScrollableParent(element.parentNode);\n    }\n    return false; // didn't find a scrollable parent\n  }\n\n  var S = {};\n\n  S.setup = function (ref) {\n    var step = ref.step;\n    var offset = ref.offset; if ( offset === void 0 ) offset = 0.5;\n    var progress = ref.progress; if ( progress === void 0 ) progress = false;\n    var threshold = ref.threshold; if ( threshold === void 0 ) threshold = 4;\n    var debug = ref.debug; if ( debug === void 0 ) debug = false;\n    var order = ref.order; if ( order === void 0 ) order = true;\n    var once = ref.once; if ( once === void 0 ) once = false;\n\n    reset();\n    // create id unique to this scrollama instance\n    id = generateInstanceID();\n\n    stepEl = selectAll(step);\n\n    if (!stepEl.length) {\n      err(\"no step elements\");\n      return S;\n    }\n\n    // ensure that no step has a scrollable parent element in the dom tree\n    // check current step for scrollable parent\n    // assume no scrollable parents to start\n    var scrollableParent = stepEl.reduce(\n      function (foundScrollable, s) { return foundScrollable || anyScrollableParent(s.parentNode); },\n      false\n    );\n    if (scrollableParent) {\n      console.error(\n        \"scrollama error: step elements cannot be children of a scrollable element. Remove any css on the parent element with overflow: scroll; or overflow: auto; on elements with fixed height.\",\n        scrollableParent\n      );\n    }\n\n    // options\n    isDebug = debug;\n    progressMode = progress;\n    preserveOrder = order;\n    triggerOnce = once;\n\n    S.offsetTrigger(offset);\n    progressThreshold = Math.max(1, +threshold);\n\n    isReady = true;\n\n    // customize\n    addDebug();\n    indexSteps();\n    setupStates();\n    handleResize();\n    S.enable();\n    return S;\n  };\n\n  S.resize = function () {\n    handleResize();\n    return S;\n  };\n\n  S.enable = function () {\n    handleEnable(true);\n    return S;\n  };\n\n  S.disable = function () {\n    handleEnable(false);\n    return S;\n  };\n\n  S.destroy = function () {\n    handleEnable(false);\n    reset();\n  };\n\n  S.offsetTrigger = function (x) {\n    if (x === null) { return offsetVal; }\n\n    if (typeof x === \"number\") {\n      format = \"percent\";\n      if (x > 1) { err(\"offset value is greater than 1. Fallback to 1.\"); }\n      if (x < 0) { err(\"offset value is lower than 0. Fallback to 0.\"); }\n      offsetVal = Math.min(Math.max(0, x), 1);\n    } else if (typeof x === \"string\" && x.indexOf(\"px\") > 0) {\n      var v = +x.replace(\"px\", \"\");\n      if (!isNaN(v)) {\n        format = \"pixels\";\n        offsetVal = v;\n      } else {\n        err(\"offset value must be in 'px' format. Fallback to 0.5.\");\n        offsetVal = 0.5;\n      }\n    } else {\n      err(\"offset value does not include 'px'. Fallback to 0.5.\");\n      offsetVal = 0.5;\n    }\n    return S;\n  };\n\n  S.onStepEnter = function (f) {\n    if (typeof f === \"function\") { cb.stepEnter = f; }\n    else { err(\"onStepEnter requires a function\"); }\n    return S;\n  };\n\n  S.onStepExit = function (f) {\n    if (typeof f === \"function\") { cb.stepExit = f; }\n    else { err(\"onStepExit requires a function\"); }\n    return S;\n  };\n\n  S.onStepProgress = function (f) {\n    if (typeof f === \"function\") { cb.stepProgress = f; }\n    else { err(\"onStepProgress requires a function\"); }\n    return S;\n  };\n\n  return S;\n}\n\nreturn scrollama;\n\n})));\n","/*!\r\n  * Stickyfill  `position: sticky` polyfill\r\n  * v. 2.1.0 | https://github.com/wilddeer/stickyfill\r\n  * MIT License\r\n  */\r\n\r\n;(function(window, document) {\r\n    'use strict';\r\n    \r\n    /*\r\n     * 1. Check if the browser supports `position: sticky` natively or is too old to run the polyfill.\r\n     *    If either of these is the case set `seppuku` flag. It will be checked later to disable key features\r\n     *    of the polyfill, but the API will remain functional to avoid breaking things.\r\n     */\r\n    \r\n    var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\r\n    \r\n    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n    \r\n    var seppuku = false;\r\n    \r\n    var isWindowDefined = typeof window !== 'undefined';\r\n    \r\n    // The polyfill cant function properly without `window` or `window.getComputedStyle`.\r\n    if (!isWindowDefined || !window.getComputedStyle) seppuku = true;\r\n    // Dontt get in a way if the browser supports `position: sticky` natively.\r\n    else {\r\n            (function () {\r\n                var testNode = document.createElement('div');\r\n    \r\n                if (['', '-webkit-', '-moz-', '-ms-'].some(function (prefix) {\r\n                    try {\r\n                        testNode.style.position = prefix + 'sticky';\r\n                    } catch (e) {}\r\n    \r\n                    return testNode.style.position != '';\r\n                })) seppuku = true;\r\n            })();\r\n        }\r\n    \r\n    /*\r\n     * 2. Global vars used across the polyfill\r\n     */\r\n    var isInitialized = false;\r\n    \r\n    // Check if Shadow Root constructor exists to make further checks simpler\r\n    var shadowRootExists = typeof ShadowRoot !== 'undefined';\r\n    \r\n    // Last saved scroll position\r\n    var scroll = {\r\n        top: null,\r\n        left: null\r\n    };\r\n    \r\n    // Array of created Sticky instances\r\n    var stickies = [];\r\n    \r\n    /*\r\n     * 3. Utility functions\r\n     */\r\n    function extend(targetObj, sourceObject) {\r\n        for (var key in sourceObject) {\r\n            if (sourceObject.hasOwnProperty(key)) {\r\n                targetObj[key] = sourceObject[key];\r\n            }\r\n        }\r\n    }\r\n    \r\n    function parseNumeric(val) {\r\n        return parseFloat(val) || 0;\r\n    }\r\n    \r\n    function getDocOffsetTop(node) {\r\n        var docOffsetTop = 0;\r\n    \r\n        while (node) {\r\n            docOffsetTop += node.offsetTop;\r\n            node = node.offsetParent;\r\n        }\r\n    \r\n        return docOffsetTop;\r\n    }\r\n    \r\n    /*\r\n     * 4. Sticky class\r\n     */\r\n    \r\n    var Sticky = function () {\r\n        function Sticky(node) {\r\n            _classCallCheck(this, Sticky);\r\n    \r\n            if (!(node instanceof HTMLElement)) throw new Error('First argument must be HTMLElement');\r\n            if (stickies.some(function (sticky) {\r\n                return sticky._node === node;\r\n            })) throw new Error('Stickyfill is already applied to this node');\r\n    \r\n            this._node = node;\r\n            this._stickyMode = null;\r\n            this._active = false;\r\n    \r\n            stickies.push(this);\r\n    \r\n            this.refresh();\r\n        }\r\n    \r\n        _createClass(Sticky, [{\r\n            key: 'refresh',\r\n            value: function refresh() {\r\n                if (seppuku || this._removed) return;\r\n                if (this._active) this._deactivate();\r\n    \r\n                var node = this._node;\r\n    \r\n                /*\r\n                 * 1. Save node computed props\r\n                 */\r\n                var nodeComputedStyle = getComputedStyle(node);\r\n                var nodeComputedProps = {\r\n                    position: nodeComputedStyle.position,\r\n                    top: nodeComputedStyle.top,\r\n                    display: nodeComputedStyle.display,\r\n                    marginTop: nodeComputedStyle.marginTop,\r\n                    marginBottom: nodeComputedStyle.marginBottom,\r\n                    marginLeft: nodeComputedStyle.marginLeft,\r\n                    marginRight: nodeComputedStyle.marginRight,\r\n                    cssFloat: nodeComputedStyle.cssFloat\r\n                };\r\n    \r\n                /*\r\n                 * 2. Check if the node can be activated\r\n                 */\r\n                if (isNaN(parseFloat(nodeComputedProps.top)) || nodeComputedProps.display == 'table-cell' || nodeComputedProps.display == 'none') return;\r\n    \r\n                this._active = true;\r\n    \r\n                /*\r\n                 * 3. Check if the current node position is `sticky`. If it is, it means that the browser supports sticky positioning,\r\n                 *    but the polyfill was force-enabled. We set the nodes position to `static` before continuing, so that the node\r\n                 *    is in its initial position when we gather its params.\r\n                 */\r\n                var originalPosition = node.style.position;\r\n                if (nodeComputedStyle.position == 'sticky' || nodeComputedStyle.position == '-webkit-sticky') node.style.position = 'static';\r\n    \r\n                /*\r\n                 * 4. Get necessary node parameters\r\n                 */\r\n                var referenceNode = node.parentNode;\r\n                var parentNode = shadowRootExists && referenceNode instanceof ShadowRoot ? referenceNode.host : referenceNode;\r\n                var nodeWinOffset = node.getBoundingClientRect();\r\n                var parentWinOffset = parentNode.getBoundingClientRect();\r\n                var parentComputedStyle = getComputedStyle(parentNode);\r\n    \r\n                this._parent = {\r\n                    node: parentNode,\r\n                    styles: {\r\n                        position: parentNode.style.position\r\n                    },\r\n                    offsetHeight: parentNode.offsetHeight\r\n                };\r\n                this._offsetToWindow = {\r\n                    left: nodeWinOffset.left,\r\n                    right: document.documentElement.clientWidth - nodeWinOffset.right\r\n                };\r\n                this._offsetToParent = {\r\n                    top: nodeWinOffset.top - parentWinOffset.top - parseNumeric(parentComputedStyle.borderTopWidth),\r\n                    left: nodeWinOffset.left - parentWinOffset.left - parseNumeric(parentComputedStyle.borderLeftWidth),\r\n                    right: -nodeWinOffset.right + parentWinOffset.right - parseNumeric(parentComputedStyle.borderRightWidth)\r\n                };\r\n                this._styles = {\r\n                    position: originalPosition,\r\n                    top: node.style.top,\r\n                    bottom: node.style.bottom,\r\n                    left: node.style.left,\r\n                    right: node.style.right,\r\n                    width: node.style.width,\r\n                    marginTop: node.style.marginTop,\r\n                    marginLeft: node.style.marginLeft,\r\n                    marginRight: node.style.marginRight\r\n                };\r\n    \r\n                var nodeTopValue = parseNumeric(nodeComputedProps.top);\r\n                this._limits = {\r\n                    start: nodeWinOffset.top + window.pageYOffset - nodeTopValue,\r\n                    end: parentWinOffset.top + window.pageYOffset + parentNode.offsetHeight - parseNumeric(parentComputedStyle.borderBottomWidth) - node.offsetHeight - nodeTopValue - parseNumeric(nodeComputedProps.marginBottom)\r\n                };\r\n    \r\n                /*\r\n                 * 5. Ensure that the node will be positioned relatively to the parent node\r\n                 */\r\n                var parentPosition = parentComputedStyle.position;\r\n    \r\n                if (parentPosition != 'absolute' && parentPosition != 'relative') {\r\n                    parentNode.style.position = 'relative';\r\n                }\r\n    \r\n                /*\r\n                 * 6. Recalc node position.\r\n                 *    Its important to do this before clone injection to avoid scrolling bug in Chrome.\r\n                 */\r\n                this._recalcPosition();\r\n    \r\n                /*\r\n                 * 7. Create a clone\r\n                 */\r\n                var clone = this._clone = {};\r\n                clone.node = document.createElement('div');\r\n    \r\n                // Apply styles to the clone\r\n                extend(clone.node.style, {\r\n                    width: nodeWinOffset.right - nodeWinOffset.left + 'px',\r\n                    height: nodeWinOffset.bottom - nodeWinOffset.top + 'px',\r\n                    marginTop: nodeComputedProps.marginTop,\r\n                    marginBottom: nodeComputedProps.marginBottom,\r\n                    marginLeft: nodeComputedProps.marginLeft,\r\n                    marginRight: nodeComputedProps.marginRight,\r\n                    cssFloat: nodeComputedProps.cssFloat,\r\n                    padding: 0,\r\n                    border: 0,\r\n                    borderSpacing: 0,\r\n                    fontSize: '1em',\r\n                    position: 'static'\r\n                });\r\n    \r\n                referenceNode.insertBefore(clone.node, node);\r\n                clone.docOffsetTop = getDocOffsetTop(clone.node);\r\n            }\r\n        }, {\r\n            key: '_recalcPosition',\r\n            value: function _recalcPosition() {\r\n                if (!this._active || this._removed) return;\r\n    \r\n                var stickyMode = scroll.top <= this._limits.start ? 'start' : scroll.top >= this._limits.end ? 'end' : 'middle';\r\n    \r\n                if (this._stickyMode == stickyMode) return;\r\n    \r\n                switch (stickyMode) {\r\n                    case 'start':\r\n                        extend(this._node.style, {\r\n                            position: 'absolute',\r\n                            left: this._offsetToParent.left + 'px',\r\n                            right: this._offsetToParent.right + 'px',\r\n                            top: this._offsetToParent.top + 'px',\r\n                            bottom: 'auto',\r\n                            width: 'auto',\r\n                            marginLeft: 0,\r\n                            marginRight: 0,\r\n                            marginTop: 0\r\n                        });\r\n                        break;\r\n    \r\n                    case 'middle':\r\n                        extend(this._node.style, {\r\n                            position: 'fixed',\r\n                            left: this._offsetToWindow.left + 'px',\r\n                            right: this._offsetToWindow.right + 'px',\r\n                            top: this._styles.top,\r\n                            bottom: 'auto',\r\n                            width: 'auto',\r\n                            marginLeft: 0,\r\n                            marginRight: 0,\r\n                            marginTop: 0\r\n                        });\r\n                        break;\r\n    \r\n                    case 'end':\r\n                        extend(this._node.style, {\r\n                            position: 'absolute',\r\n                            left: this._offsetToParent.left + 'px',\r\n                            right: this._offsetToParent.right + 'px',\r\n                            top: 'auto',\r\n                            bottom: 0,\r\n                            width: 'auto',\r\n                            marginLeft: 0,\r\n                            marginRight: 0\r\n                        });\r\n                        break;\r\n                }\r\n    \r\n                this._stickyMode = stickyMode;\r\n            }\r\n        }, {\r\n            key: '_fastCheck',\r\n            value: function _fastCheck() {\r\n                if (!this._active || this._removed) return;\r\n    \r\n                if (Math.abs(getDocOffsetTop(this._clone.node) - this._clone.docOffsetTop) > 1 || Math.abs(this._parent.node.offsetHeight - this._parent.offsetHeight) > 1) this.refresh();\r\n            }\r\n        }, {\r\n            key: '_deactivate',\r\n            value: function _deactivate() {\r\n                var _this = this;\r\n    \r\n                if (!this._active || this._removed) return;\r\n    \r\n                this._clone.node.parentNode.removeChild(this._clone.node);\r\n                delete this._clone;\r\n    \r\n                extend(this._node.style, this._styles);\r\n                delete this._styles;\r\n    \r\n                // Check whether elements parent node is used by other stickies.\r\n                // If not, restore parent nodes styles.\r\n                if (!stickies.some(function (sticky) {\r\n                    return sticky !== _this && sticky._parent && sticky._parent.node === _this._parent.node;\r\n                })) {\r\n                    extend(this._parent.node.style, this._parent.styles);\r\n                }\r\n                delete this._parent;\r\n    \r\n                this._stickyMode = null;\r\n                this._active = false;\r\n    \r\n                delete this._offsetToWindow;\r\n                delete this._offsetToParent;\r\n                delete this._limits;\r\n            }\r\n        }, {\r\n            key: 'remove',\r\n            value: function remove() {\r\n                var _this2 = this;\r\n    \r\n                this._deactivate();\r\n    \r\n                stickies.some(function (sticky, index) {\r\n                    if (sticky._node === _this2._node) {\r\n                        stickies.splice(index, 1);\r\n                        return true;\r\n                    }\r\n                });\r\n    \r\n                this._removed = true;\r\n            }\r\n        }]);\r\n    \r\n        return Sticky;\r\n    }();\r\n    \r\n    /*\r\n     * 5. Stickyfill API\r\n     */\r\n    \r\n    \r\n    var Stickyfill = {\r\n        stickies: stickies,\r\n        Sticky: Sticky,\r\n    \r\n        forceSticky: function forceSticky() {\r\n            seppuku = false;\r\n            init();\r\n    \r\n            this.refreshAll();\r\n        },\r\n        addOne: function addOne(node) {\r\n            // Check whether its a node\r\n            if (!(node instanceof HTMLElement)) {\r\n                // Maybe its a node list of some sort?\r\n                // Take first node from the list then\r\n                if (node.length && node[0]) node = node[0];else return;\r\n            }\r\n    \r\n            // Check if Stickyfill is already applied to the node\r\n            // and return existing sticky\r\n            for (var i = 0; i < stickies.length; i++) {\r\n                if (stickies[i]._node === node) return stickies[i];\r\n            }\r\n    \r\n            // Create and return new sticky\r\n            return new Sticky(node);\r\n        },\r\n        add: function add(nodeList) {\r\n            // If its a node make an array of one node\r\n            if (nodeList instanceof HTMLElement) nodeList = [nodeList];\r\n            // Check if the argument is an iterable of some sort\r\n            if (!nodeList.length) return;\r\n    \r\n            // Add every element as a sticky and return an array of created Sticky instances\r\n            var addedStickies = [];\r\n    \r\n            var _loop = function _loop(i) {\r\n                var node = nodeList[i];\r\n    \r\n                // If its not an HTMLElement  create an empty element to preserve 1-to-1\r\n                // correlation with input list\r\n                if (!(node instanceof HTMLElement)) {\r\n                    addedStickies.push(void 0);\r\n                    return 'continue';\r\n                }\r\n    \r\n                // If Stickyfill is already applied to the node\r\n                // add existing sticky\r\n                if (stickies.some(function (sticky) {\r\n                    if (sticky._node === node) {\r\n                        addedStickies.push(sticky);\r\n                        return true;\r\n                    }\r\n                })) return 'continue';\r\n    \r\n                // Create and add new sticky\r\n                addedStickies.push(new Sticky(node));\r\n            };\r\n    \r\n            for (var i = 0; i < nodeList.length; i++) {\r\n                var _ret2 = _loop(i);\r\n    \r\n                if (_ret2 === 'continue') continue;\r\n            }\r\n    \r\n            return addedStickies;\r\n        },\r\n        refreshAll: function refreshAll() {\r\n            stickies.forEach(function (sticky) {\r\n                return sticky.refresh();\r\n            });\r\n        },\r\n        removeOne: function removeOne(node) {\r\n            // Check whether its a node\r\n            if (!(node instanceof HTMLElement)) {\r\n                // Maybe its a node list of some sort?\r\n                // Take first node from the list then\r\n                if (node.length && node[0]) node = node[0];else return;\r\n            }\r\n    \r\n            // Remove the stickies bound to the nodes in the list\r\n            stickies.some(function (sticky) {\r\n                if (sticky._node === node) {\r\n                    sticky.remove();\r\n                    return true;\r\n                }\r\n            });\r\n        },\r\n        remove: function remove(nodeList) {\r\n            // If its a node make an array of one node\r\n            if (nodeList instanceof HTMLElement) nodeList = [nodeList];\r\n            // Check if the argument is an iterable of some sort\r\n            if (!nodeList.length) return;\r\n    \r\n            // Remove the stickies bound to the nodes in the list\r\n    \r\n            var _loop2 = function _loop2(i) {\r\n                var node = nodeList[i];\r\n    \r\n                stickies.some(function (sticky) {\r\n                    if (sticky._node === node) {\r\n                        sticky.remove();\r\n                        return true;\r\n                    }\r\n                });\r\n            };\r\n    \r\n            for (var i = 0; i < nodeList.length; i++) {\r\n                _loop2(i);\r\n            }\r\n        },\r\n        removeAll: function removeAll() {\r\n            while (stickies.length) {\r\n                stickies[0].remove();\r\n            }\r\n        }\r\n    };\r\n    \r\n    /*\r\n     * 6. Setup events (unless the polyfill was disabled)\r\n     */\r\n    function init() {\r\n        if (isInitialized) {\r\n            return;\r\n        }\r\n    \r\n        isInitialized = true;\r\n    \r\n        // Watch for scroll position changes and trigger recalc/refresh if needed\r\n        function checkScroll() {\r\n            if (window.pageXOffset != scroll.left) {\r\n                scroll.top = window.pageYOffset;\r\n                scroll.left = window.pageXOffset;\r\n    \r\n                Stickyfill.refreshAll();\r\n            } else if (window.pageYOffset != scroll.top) {\r\n                scroll.top = window.pageYOffset;\r\n                scroll.left = window.pageXOffset;\r\n    \r\n                // recalc position for all stickies\r\n                stickies.forEach(function (sticky) {\r\n                    return sticky._recalcPosition();\r\n                });\r\n            }\r\n        }\r\n    \r\n        checkScroll();\r\n        window.addEventListener('scroll', checkScroll);\r\n    \r\n        // Watch for window resizes and device orientation changes and trigger refresh\r\n        window.addEventListener('resize', Stickyfill.refreshAll);\r\n        window.addEventListener('orientationchange', Stickyfill.refreshAll);\r\n    \r\n        //Fast dirty check for layout changes every 500ms\r\n        var fastCheckTimer = void 0;\r\n    \r\n        function startFastCheckTimer() {\r\n            fastCheckTimer = setInterval(function () {\r\n                stickies.forEach(function (sticky) {\r\n                    return sticky._fastCheck();\r\n                });\r\n            }, 500);\r\n        }\r\n    \r\n        function stopFastCheckTimer() {\r\n            clearInterval(fastCheckTimer);\r\n        }\r\n    \r\n        var docHiddenKey = void 0;\r\n        var visibilityChangeEventName = void 0;\r\n    \r\n        if ('hidden' in document) {\r\n            docHiddenKey = 'hidden';\r\n            visibilityChangeEventName = 'visibilitychange';\r\n        } else if ('webkitHidden' in document) {\r\n            docHiddenKey = 'webkitHidden';\r\n            visibilityChangeEventName = 'webkitvisibilitychange';\r\n        }\r\n    \r\n        if (visibilityChangeEventName) {\r\n            if (!document[docHiddenKey]) startFastCheckTimer();\r\n    \r\n            document.addEventListener(visibilityChangeEventName, function () {\r\n                if (document[docHiddenKey]) {\r\n                    stopFastCheckTimer();\r\n                } else {\r\n                    startFastCheckTimer();\r\n                }\r\n            });\r\n        } else startFastCheckTimer();\r\n    }\r\n    \r\n    if (!seppuku) init();\r\n    \r\n    /*\r\n     * 7. Expose Stickyfill\r\n     */\r\n    if (typeof module != 'undefined' && module.exports) {\r\n        module.exports = Stickyfill;\r\n    } else if (isWindowDefined) {\r\n        window.Stickyfill = Stickyfill;\r\n    }\r\n    \r\n})(window, document);","import isMobile from './utils/is-mobile';\n\nexport default function getChapter(){\n    const is_mobile = isMobile.any();\n    const zoomOffset = is_mobile? -1: 0;\n    const chapter = {\n        'overview': {\n            'pos': {\n                center: [-75.4532737, 40.743598],\n                zoom: 9+zoomOffset,\n            },\n        },\n        'downtown': {\n            'pos': {\n                center: [-75.216534, 40.690825],\n                zoom: 13+zoomOffset,\n            },\n        },\n        'westWard': {\n            'pos': {\n                center: [-75.230782, 40.689133],\n                zoom: 14.5+zoomOffset,\n            }\n        },\n        'wilson': {\n            'pos': {\n                center: [-75.2593601, 40.6832623],\n                zoom: 14+zoomOffset,\n            }\n        },\n        'palmer': {\n            'pos': {\n                center: [-75.3300012, 40.7006325],\n                zoom: 12+zoomOffset,\n            }\n        },\n        'lower_nazareth': {\n            'pos': {\n                center: [-75.3636675, 40.7083363],\n                zoom: 13+zoomOffset,\n            }\n        },\n        'nazareth':{\n            'pos': {\n                center: [-75.3315301, 40.7409816],\n                zoom: 14+zoomOffset,\n            }\n        },\n        'upper_nazareth':{\n            'pos': {\n                center: [-75.3640785, 40.7362281],\n                zoom: 13+zoomOffset,\n            }\n        },\n        'bath':{\n            'pos': {\n                center: [-75.4000157, 40.7271674],\n                zoom: 15+zoomOffset,\n            }\n        },\n        'east_allen':{\n            'pos': {\n                center: [-75.453309, 40.7033208],\n                zoom: 13+zoomOffset,\n            }\n        },\n        'moore':{\n            'pos': {\n                center: [-75.4924025, 40.7830633],\n                zoom: 12+zoomOffset,\n            }\n        },\n        'north':{\n            'pos': {\n                center: [-75.6103863, 40.7660173],\n                zoom: 12+zoomOffset,\n            }\n        }\n\n    }\n    return chapter;\n}","function getCottingham() {\n    const cottingham = [[40.691921, -75.226414], [40.690959, -75.226328], [40.691040, -75.224440], [40.692040, -75.224554], [40.691921, -75.226414]]\n    const cData = cottingham.map(d=>[d[1], d[0]])\n    return parseGeoData(cData);\n}\n\nfunction parseGeoData(arr) {\n    return {\n        'type': 'Feature',\n        'geometry': {\n            'type': 'LineString',\n            'coordinates': arr\n        }\n    }\n}\n\nexport default { getCottingham, }","export default function getSize(id){\n    const width = document.querySelector(`#${id}`).clientWidth;\n    const height = document.querySelector(`#${id}`).clientHeight;\n    return [width, height]\n}","export default function slugify(string){\n  const a = '/_,:;'\n  const b = 'aaaaaaaaaacccddeeeeeeeegghiiiiiilmnnnnoooooooooprrsssssttuuuuuuuuuwxyyzzz------'\n  const p = new RegExp(a.split('').join('|'), 'g')\n\n  return string.toString().toLowerCase()\n    .replace(/\\s+/g, '-') // Replace spaces with -\n    .replace(p, c => b.charAt(a.indexOf(c))) // Replace special characters\n    .replace(/[^\\w\\-]+/g, '') // Remove all non-word characters\n    .replace(/\\-\\-+/g, '-') // Replace multiple - with single -\n    .replace(/^-+/, '') // Trim - from start of text\n    .replace(/-+$/, '') // Trim - from end of text\n}","import getSize from './getSize';\nimport isMobile from './utils/is-mobile';\nimport slugify from './utils/slugify.js';\n\nfunction Map(data) {\n    let [W, H] = getSize('map');\n    const $svg = d3.select('#map__svg');\n    const { routeData, townData, townInfo, markerData } = data;\n    const _red = '#D30E14', _purple = \"#95519e\", _blue = '#307FE2', _green = '#BAD131', _green2 = \"#006d18\";\n    const is_mobile = isMobile.any();\n    let _transition = `translate(${is_mobile ? -W * .7 : 0}, 0)scale(1)`;\n    \n    function init() {\n        [W, H] = getSize('map');\n        $svg.attr('width', W)\n            .attr('height', H)\n        const $plotG = $svg.selectAll('.plotG')\n            .data([1])\n            .join('g')\n            .attr('class', 'plotG')\n            .attr('transform', `translate(0, 0)`)\n\n        $plotG.selectAll('.layerG')\n            .data(['countyG', 'routeG', 'labelG', 'markerG', 'noteG'])\n            .join('g')\n            .attr('class', d => `layerG ${d}`)\n\n        const $countyG = $plotG.select('.countyG').attr('transform', 'translate(0, 20)');\n        const $routeG = $plotG.select('.routeG').attr('transform', 'translate(0, 20)');\n        // const $legendG = $plotG.select('.legendG');\n        const $noteG = $plotG.select('.noteG').classed('active', true)\n        // const $annotationG = $plotG.select('.annotationG')\n        //     .attr('transform', `translate(${W / 3}, 50)`)\n        //     .classed('active', true);\n        // const projection = d3.geoMercator()\n        //     .scale([mapScale])\n        //     .translate([W/2, H/2])\n            // .center(centre_county);\n        const projection = d3.geoTransverseMercator()\n        .rotate([76 + 30 / 60, -38 - 50 / 60])\n        .fitExtent([[60, 10], [W-60, Math.min(W-70, H*.7-40) ]], townData)\n        const path = d3.geoPath()\n            .projection(projection);\n\n\n        const startPoint = projection([-75.698890972731462, 40.829051151673362])\n   \n        $countyG.selectAll('.ctyPath')\n            .data(townData.features)\n            .join(\"path\")\n            .attr('d', path)\n            .attr('class', 'ctyPath')\n            .attr('id', d => slugify(d.properties['Northampton Precinct Vote_pct_town_name']))\n            .attr(\"fill\", d => fillFunc(d))\n            .attr(\"stroke-width\", 1)\n            .attr(\"stroke\", \"#e2e3e4\")\n\n        $routeG.selectAll('.routePath')\n            .data(routeData.features)\n            .join(\"path\")\n            .attr('d', path)\n            .attr(\"fill\", 'none')\n            .attr(\"stroke-width\", 5)\n            .attr(\"stroke\", \"#333333\")\n\n        $noteG.selectAll('.note')\n        .data(['Route 248'])\n        .join('text')\n        .attr('class', 'note')\n        .text(d=> d)\n        .attr('x', startPoint[0]+20)\n        .attr('y', startPoint[1]+20)\n        .attr('fill', '#333333')\n        .attr('font-weight', 800)\n\n    }\n\n    init.circleLoop = function (_loop) {\n        if (_loop) {\n            $svg.select('.markerG')\n                .selectAll('.marker')\n                .attr('r', 1)\n                .transition()\n                .duration(1000)\n                .attr('r', 5)\n                .transition()\n                .delay(1000)\n                .attr('r', 1)\n            // .each(\"end\", this.circleLoop(true));\n        }\n    }\n\n    init.highlightTown = function (arr) {\n        const $countyG = $svg.select('.countyG');\n        if (!arr.length) {\n            $countyG\n                .selectAll('.ctyPath')\n                .attr('stroke-width', 1)\n                .attr('stroke', 'white')\n                .attr('opacity', 1)\n                .attr('fill-opacity', 1)\n                return;\n        }\n        \n        $countyG\n            .selectAll('.ctyPath')\n            .attr('stroke-width', 1)\n            .attr('stroke', 'white')\n            .attr('opacity', 0.1 )\n            // .attr('fill-opacity', is_mobile? 0.1: 0.3)\n\n        arr.forEach( (d,i) => {\n            $countyG.select(`#${slugify(d)}`)\n                .attr('stroke-width', 4)\n                .attr('opacity', 1 )\n                .attr('stroke', _green )\n                .attr('fill-opacity', '1')\n                .raise();\n        })\n        // $countyG.select(`#${}`)\n        //     .selectAll('.ctyPath')\n        //     .attr(\"stroke-width\", d=>{\n        //         console.log(d.properties['Northampton Precinct Vote_pct_town_name'])\n        //         return arr.indexOf(d.properties['Northampton Precinct Vote_pct_town_name'])>-1? 5: 1\n        //     })\n        //     .attr(\"stroke\", d=>{\n        //         return arr.indexOf(d.properties['Northampton Precinct Vote_pct_town_name'])>-1? 'gold': 'white'\n        //     })\n    }\n    init.transitMap = function (_transition) {\n        W = getSize('map')[0];\n        $svg.select('.plotG')\n            .transition()\n            .duration(750)\n            .attr(\"transform\", _transition)\n            .style(\"stroke-width\", 1.5 + \"px\");\n    }\n\n    function fillFunc(d) {\n        const attr = d.properties['Northampton Precinct Vote_pct_pct'];\n        const fillColor = d3.scaleLinear()\n            .domain([-0.4, 0.4])\n            .range([_blue, _red]);\n        return fillColor(attr)\n    }\n\n    function parseChapterData(data) {\n        const arr = [];\n        for (const attr in data) {\n            if (attr != 'overview') {\n                arr.push({ 'attr': attr, 'pos': data[attr].pos.center })\n            }\n        }\n        return arr;\n    }\n\n    return init\n}\n\nexport default Map;","import getSize from './getSize';\nimport isMobile from './utils/is-mobile';\nimport slugify from './utils/slugify';\n\nfunction ScatterPlot(townInfo) {\n    let [W, H] = getSize('map');\n    const $svg = d3.select('#map__svg');\n    const _red = '#D30E14', _green = \"#BAD131\", _green2 = \"#006d18\", _purple = \"#95519e\", _blue = '#307FE2', _yellow = '#BAD131', _gray = '#888888';\n    const is_mobile = isMobile.any();\n\n    function init() {\n        [W, H] = getSize('map');\n        const rangeW = 160;\n        const $scatterG = $svg.selectAll('.scatterG')\n            .data([1])\n            .join('g')\n            .attr('class', `scatterG`)\n            .attr('transform', `translate(${(W / 2 - 280 - rangeW) / 3}, ${H - 230})`)\n\n        $scatterG.selectAll('.catG')\n            .data(['popG', 'incomeG', 'ownerG', 'bachelorG', 'headlineG', 'tooltipG', 'legendG'])\n            .join('g')\n            .attr('class', 'catG')\n            .attr('id', d => d)\n            .attr('transform', (d, i) => `translate(0, ${(i < 4) ? 55 * i : 0})`)\n        const $popG = $scatterG.select('#popG');\n        const popScale = d3.scaleLinear().domain([0, 30000]).range([0, rangeW]);\n        createScale($popG, popScale, 'pop', \"Population\")\n\n        const $incomeG = $scatterG.select('#incomeG');\n        const incomeScale = d3.scaleLinear().domain([40000, 110000]).range([0, rangeW]);\n        createScale($incomeG, incomeScale, 'income', \"Median household income\")\n\n        const $ownerG = $scatterG.select('#ownerG');\n        const ownerScale = d3.scaleLinear().domain([0.4, 1]).range([0, rangeW]);\n        createScale($ownerG, ownerScale, 'owner', \"Homeownership rate\")\n\n        const $bachelorG = $scatterG.select('#bachelorG');\n        const bachelorScale = d3.scaleLinear().domain([0.1, 0.5]).range([0, rangeW]);\n        createScale($bachelorG, bachelorScale, 'bachelor', \"College-educated residents\")\n\n        const $headlineG = $scatterG.select('#headlineG')\n            .attr('transform', `translate(0, -58)`);\n        const $legendG = $scatterG.select('#legendG')\n            .attr('transform', `translate(0, -24)`);\n        $legendG.selectAll('text')\n            .data([' represents a town'])\n            .join('text')\n            .text(d => d)\n            .attr('fill', '#686868')\n            .attr('font-size', 11)\n\n\n        $headlineG.selectAll('.headline')\n            .data(['Demographics of', 'towns'])\n            .join(\"text\")\n            .attr('transform', (d, i) => `translate(0, ${i * 16})`)\n            .attr('class', 'headline')\n            .attr('id', (d, i) => `${'hed_' + i}`)\n            .text(d => d)\n            .attr('fill', (d, i) => i == 0 ? '#333333' : _green)\n            .attr('font-size', '14px')\n            .attr('font-weight', 900)\n\n        function createScale($g, scale, attr, title = '') {\n            $g.selectAll('.rectBG')\n                .data([1])\n                .join('rect')\n                .attr('class', 'rectBG')\n                .attr('width', rangeW + 1)\n                .attr('height', 10)\n                .attr('x', 0)\n                .attr('y', 0)\n                .attr('fill', '#eeeeee')\n\n            var yAxis = d3.axisBottom()\n                .scale(scale)\n                .ticks(4)\n                .tickSize(10)\n                .tickFormat(d => (d <= 1) ? (d == 0 ? 0 : d * 100 + '%') : (d === 40000 ? '$40k' : (d > 1000 ? d / 1000 + 'k' : d)))\n\n            const axis = $g.selectAll('.axisG')\n                .data([1])\n                .join('g')\n                .attr('class', 'axisG')\n                .attr('transform', `translate(0, 0)`)\n                .attr(\"class\", \"y axis\")\n                .attr('fill', _gray)\n                .call(yAxis);\n\n\n\n            const circle = $g.selectAll('.town')\n                .data(townInfo)\n                .join('circle')\n                .attr('class', d => `town ${slugify(d.town)}`)\n                .attr('cx', d => scale(d[attr]))\n                .attr('cy', 5)\n                .attr('r', 3)\n                .attr('stroke', _gray)\n                .attr('fill', _gray)\n                .attr('fill-opacity', 0.3);\n\n            circle.on('mouseover', function (d) {\n                console.log('mouseover!!!')\n                const id = d3.select(this).attr('class')\n                const _id = id.replace('town ', '')\n                $scatterG.selectAll(`.${_id}`)\n                    .attr('fill-opacity', 1)\n                    .attr('r', 5).attr('fill', _green).raise();\n\n                const posX = $popG.select(`.${_id}`).attr('cx')\n                const posY = $popG.select(`.${_id}`).attr('cy')\n\n            })\n                .on('mouseout', function () {\n                    $scatterG.selectAll(`.town`).attr('fill', _gray)\n                        .attr('r', 3)\n                        .attr('fill-opacity', 0.3);\n                })\n\n\n\n\n            axis\n                .append(\"text\")\n                .attr('class', 'scatter__title')\n                .attr(\"transform\", `translate(0, 0)`)\n                .attr(\"y\", -7)\n                .attr(\"dy\", \"0\")\n                .style(\"text-anchor\", \"start\")\n                .attr('fill', '#333333')\n                .attr('font-weight', '600')\n                .attr('font-size', '12px')\n                .text(title);\n\n            axis.selectAll('.domain').remove()\n\n        }\n\n    }\n\n    init.active = function () {\n        const isActive = `${(W >= 960) ? 'active' : ''}`;\n        if (isActive != '') {\n            $svg.selectAll('.scatterG').classed('active', true)\n        }\n    }\n\n    init.highlightTown = function (arr) {\n        const $scatterG = $svg.selectAll('.scatterG')\n        $scatterG.selectAll(`.town`).attr('fill', _gray)\n            .attr('r', 3)\n            .attr('fill-opacity', 0.3);\n\n        if (arr[0] == 'West Easton') {\n            arr.shift()\n        }\n\n        arr.forEach((d, i) => {\n            console.log(slugify(d));\n            $scatterG.selectAll(`.${slugify(d)}`)\n                .attr('fill-opacity', 1)\n                .attr('r', 5).attr('fill', i == 0 ? _green : _green2).raise();\n        })\n\n        const hed_1 = $svg.select('#headlineG')\n            .select('#hed_1');\n        if (arr.length > 1) {\n            hed_1.select('*').remove()\n            hed_1.text(arr[0] + ', ')\n            hed_1.append('tspan')\n                .text(arr[1])\n                .attr('fill', _green2)\n        } else {\n            hed_1.select('*').remove()\n            hed_1.text(arr[0]).attr('fill', _green)\n        }\n\n    }\n\n\n    return init\n}\n\nexport default ScatterPlot;","export default function lazyLoadVideo() {\n    const allVideoElem = ['overview__video', 'palmer__video', 'lehigh__video', 'ending__video'];\n    allVideoElem.forEach(videoEl => {\n        const $video = d3.select(`#${videoEl}`);\n        const dataSrc = $video.attr('data-src');\n        $video.append('source').attr('src', dataSrc);\n        document.getElementById(`${videoEl}`).load(); // this line somehow fixed my mobile (iphone6s, Safari) view\n    });\n}\n","import isMobile from './utils/is-mobile';\n\nexport default function lazyLoadImg() {\n    const is_mobile = isMobile.any();\n\n    const allElem = ['.article__graphic', '.article__img', '.article__locator'];\n    allElem.forEach(d => {\n        if (!is_mobile && ['.article__graphic', '.article__locator'].indexOf(d) > -1) {\n            // desktop \n            return;\n        } else {\n            const allNodes = d3.selectAll(`img${d}`).nodes();\n            allNodes.forEach(node => {\n                const pic = d3.select(node);\n                const dataSrc = pic.attr('data-src')\n                pic.attr('src', dataSrc);\n            })\n        }\n    })\n}","/* global d3 */\n// import Map from './map';\n// import enterView from 'enter-view';\nimport scrollama from \"scrollama\";\nimport Stickyfill from 'stickyfilljs';\nimport getChapter from './chapter.js';\nimport isMobile from './utils/is-mobile.js';\nimport geoData from './geoData.js';\nimport simpleMap from './simpleMap';\nimport getSize from './getSize';\nimport ScatterPlot from './scatterplot';\nimport lazyLoadVideo from './lazyLoadVideo';\nimport lazyLoadImg from './lazyLoadImg';\n\nfunction resize(data) {\n\t// console.log('graphic resize', data);\n\t// const {routeData, townData, townInfo, markerData} = data;\n\t// simpleMap({ routeData, townData, townInfo, markerData })();\n}\n\nfunction init(data) {\n\tconst { routeData, townData, townInfo, markerData } = data\n\tconsole.log('Make something awesome!');\n\tStickyfill.add(d3.select('.sticky').node());\n\tlet [W, H] = getSize('map');\n\tconst chapter = getChapter();\n\tconst is_mobile = isMobile.any();\n\tconst maxMobileSize = 900;\n\tconst $svg = d3.select('#map__svg');\n\n\tconst scatterplot = ScatterPlot(townInfo)\n\tscatterplot();\n\tconst Map = simpleMap({ routeData, townData, townInfo, markerData });\n\tMap();\n\n\tlazyLoadVideo();\n\tconsole.log('after video, start img');\n\tlazyLoadImg();\n\t/////////// Scrollytelling //////////////\n\tconst scroller = scrollama();\n\tscroller\n\t\t.setup({\n\t\t\tstep: \".step\",\n\t\t\toffset: 0.9\n\t\t})\n\t\t.onStepEnter((response) => {\n\t\t\tconst { element, index, direction } = response;\n\t\t\tif (direction === 'down') {\n\t\t\t\tconst attr = d3.select(element).attr('data-attr');\n\t\t\t\tupdateGraphic(index, attr, element)\n\t\t\t}\n\t\t})\n\t\t.onStepExit((response) => {\n\t\t\tconst { element, index, direction } = response;\n\t\t\tif (direction === 'up') {\n\t\t\t\tif (index == 0) {\n\t\t\t\t\tMap.transitMap(`translate(0, 0)`);\n\t\t\t\t\tMap.highlightTown([])\n\t\t\t\t\td3.select('.map__header').classed('active', true);\n\t\t\t\t\td3.select('.map__legend').classed('active', true);\n\t\t\t\t\t$svg.select('.noteG').classed('active', true)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst newIdx = Math.max(index - 1, 0);\n\t\t\t\tconst attr = d3.select(`#step-${newIdx}`).attr('data-attr');\n\t\t\t\td3.select(element).classed('active', false);\n\t\t\t\tupdateGraphic(newIdx, attr, element)\n\t\t\t}\n\t\t});\n\n\n\n\tfunction updateGraphic(dataIdx, attr, element) {\n\t\tconsole.log('updateGraphic: ', dataIdx, attr);\n\t\td3.select(element).selectAll('.highlight').classed('active', false);\n\t\td3.select(element).select('.hed').select('.highlight').classed('active', true);\n\t\td3.select('.map__header').classed('active', false);\n\t\td3.select('.map__legend').classed('active', false);\n\t\t$svg.select('.annotationG').classed('active', false);\n\t\t$svg.select('.noteG').classed('active', false)\n\t\tconst thisChapter = chapter[attr];\n\t\tswitch (attr) {\n\t\t\tcase 'overview':\n\t\t\t\tMap.transitMap(`translate(${W <= 768? 0 : -W / 7}, 0)scale(${W <=768 ? 0.3 : .5})`);\n\t\t\t\tMap.highlightTown(['Easton', 'West Easton', 'Wilson Borough', 'Palmer', 'Lower Nazareth', 'Nazareth', \"Upper Nazareth\", \"Bath\", \"East Allen\", \"Moore\", \"Lehigh Twp.\"])\n\t\t\t\t$svg.selectAll('.scatterG').classed('active', false);\n\t\t\t\tbreak;\n\t\t\tcase 'downtown':\n\t\t\t\tMap.highlightTown(['Easton']);\n\t\t\t\tscatterplot.active()\n\t\t\t\tscatterplot.highlightTown(['Easton'])\n\t\t\t\tbreak;\n\t\t\tcase 'westWard':\n\t\t\t\tMap.highlightTown(['West Easton', 'Wilson Borough'])\n\t\t\t\tscatterplot.active()\n\t\t\t\tscatterplot.highlightTown(['West Easton', 'Wilson Borough'])\n\t\t\t\tbreak;\n\t\t\tcase 'palmer':\n\t\t\t\tMap.highlightTown(['Palmer', 'Lower Nazareth'])\n\t\t\t\tscatterplot.active()\n\t\t\t\tscatterplot.highlightTown(['Palmer', 'Lower Nazareth'])\n\t\t\t\tbreak;\n\t\t\tcase 'nazareth':\n\t\t\t\tMap.highlightTown(['Nazareth', \"Upper Nazareth\"])\n\t\t\t\tscatterplot.highlightTown(['Nazareth', \"Upper Nazareth\"])\n\t\t\t\tbreak;\n\t\t\tcase 'bath':\n\t\t\t\tMap.highlightTown(['Bath'])\n\t\t\t\tscatterplot.highlightTown(['Bath'])\n\t\t\t\tbreak;\n\t\t\tcase 'moore':\n\t\t\t\tMap.highlightTown([\"East Allen\", \"Moore\"])\n\t\t\t\tscatterplot.highlightTown([\"East Allen\", \"Moore\"])\n\t\t\t\tbreak;\n\t\t\tcase 'lehigh':\n\t\t\t\tMap.highlightTown([\"Lehigh Twp.\"])\n\t\t\t\tscatterplot.highlightTown([\"Lehigh Twp.\"])\n\t\t\t\tbreak;\n\t\t}\n\n\t}\n\n\n\n}\n\nexport default { init, resize };\n","const fallbackData = [\n  {\n    image: '2018_02_stand-up',\n    url: '2018/02/stand-up',\n    hed: 'The Structure of Stand-Up Comedy',\n  },\n  {\n    image: '2018_04_birthday-paradox',\n    url: '2018/04/birthday-paradox',\n    hed: 'The Birthday Paradox Experiment',\n  },\n  {\n    image: '2018_11_boy-bands',\n    url: '2018/11/boy-bands',\n    hed: 'Internet Boy Band Database',\n  },\n  {\n    image: '2018_08_pockets',\n    url: '2018/08/pockets',\n    hed: 'Womens Pockets are Inferior',\n  },\n];\n\nlet storyData = null;\n\nfunction loadJS(src, cb) {\n  const ref = document.getElementsByTagName('script')[0];\n  const script = document.createElement('script');\n  script.src = src;\n  script.async = true;\n  ref.parentNode.insertBefore(script, ref);\n\n  if (cb && typeof cb === 'function') {\n    script.onload = cb;\n  }\n\n  return script;\n}\n\nfunction loadStories(cb) {\n  const request = new XMLHttpRequest();\n  const v = Date.now();\n  const url = `https://pudding.cool/assets/data/stories.json?v=${v}`;\n  request.open('GET', url, true);\n\n  request.onload = () => {\n    if (request.status >= 200 && request.status < 400) {\n      const data = JSON.parse(request.responseText);\n      cb(data);\n    } else cb(fallbackData);\n  };\n\n  request.onerror = () => cb(fallbackData);\n\n  request.send();\n}\n\nfunction createLink(d) {\n  return `\n\t<a class='footer-recirc__article' href='https://pudding.cool/${\n    d.url\n  }' target='_blank'>\n\t\t<img class='article__img' src='https://pudding.cool/common/assets/thumbnails/640/${\n      d.image\n    }.jpg' alt='${d.hed}'>\n\t\t<p class='article__headline'>${d.hed}</p>\n\t</a>\n\t`;\n}\n\nfunction recircHTML() {\n  const url = window.location.href;\n  const html = storyData\n    .filter(d => !url.includes(d.url))\n    .slice(0, 4)\n    .map(createLink)\n    .join('');\n\n  d3.select('.pudding-footer .footer-recirc__articles').html(html);\n}\n\nfunction setupSocialJS() {\n  // facebook\n  (function(d, s, id) {\n    let js;\n\n    const fjs = d.getElementsByTagName(s)[0];\n    if (d.getElementById(id)) return;\n    js = d.createElement(s);\n    js.id = id;\n    js.src = '//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.7';\n    fjs.parentNode.insertBefore(js, fjs);\n  })(document, 'script', 'facebook-jssdk');\n\n  loadJS('https://platform.twitter.com/widgets.js');\n}\n\nfunction init() {\n  loadStories(data => {\n    storyData = data;\n\n    recircHTML();\n    setupSocialJS();\n  });\n}\n\nexport default { init };\n","/* global d3 */\nimport debounce from 'lodash.debounce';\nimport isMobile from './utils/is-mobile';\nimport graphic from './graphic';\nimport footer from './footer';\n\nconst $body = d3.select('body');\nlet previousWidth = 0;\n\n\nfunction setupStickyHeader() {\n  const $header = $body.select('header');\n  if ($header.classed('is-sticky')) {\n    const $menu = $body.select('.header__menu');\n    const $toggle = $body.select('.header__toggle');\n    $toggle.on('click', () => {\n      const visible = $menu.classed('is-visible');\n      $menu.classed('is-visible', !visible);\n      $toggle.classed('is-visible', !visible);\n    });\n  }\n}\n\nfunction init() {\n  // add mobile class to body tag\n  $body.classed('is-mobile', isMobile.any());\n  // setup resize event\n\n  // setup sticky header menu\n  setupStickyHeader();\n  // kick off graphic code\n  Promise.all([\n    // DEV\n    d3.json(\"./assets/data/Route248.geojson\"),\n    d3.json(\"./assets/data/Northampton.geojson\"),\n    d3.csv(\"./assets/data/Route248_data.csv\"),\n    d3.json(\"./assets/data/markerData.json\")\n  ]).then(function (files) {\n    const routeData = files[0];\n    const townData = files[1];\n    const townInfo = files[2];\n    const markerData = files[3];\n    graphic.init({ routeData, townData, townInfo, markerData });\n\n    window.addEventListener('resize', debounce(function resize() {\n      const width = $body.node().offsetWidth;\n      if (previousWidth !== width) {\n        previousWidth = width;\n        graphic.resize({ routeData, townData, townInfo, markerData });\n      }\n    }, 250));\n\n  });\n\n  // load footer stories\n  footer.init();\n}\n\ninit();\n"]}